[phases.setup]
nixPkgs = [
    "php82",
    "php82Extensions.pdo_mysql",
    "php82Extensions.mbstring",
    "php82Extensions.openssl",
    "php82Extensions.curl",
    "php82Extensions.zip",
    "php82Packages.composer",
    "caddy",
    "mysql-client"
]

[phases.install]
cmds = ["composer install --no-dev --optimize-autoloader"]

[start]
# Run database setup/migrations before starting the PHP server
cmd = "php scripts/database_setup_runner.php && caddy run --config Caddyfile --adapter caddyfile"
